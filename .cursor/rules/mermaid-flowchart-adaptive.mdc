---
description: 시간 정보 자동 감지 프로세스맵 작성 (시간 있으면 표시, 없으면 생략)
---

# Mermaid Flowchart Adaptive - 적응형 프로세스맵 작성 규칙

## 목적

**시간 정보의 유무를 자동 감지**하여, 있으면 표시하고 없으면 생략하는 유연한 프로세스맵 작성 규칙입니다.

## 핵심 특징

1. **적응형 (Adaptive)**: 입력 데이터에 시간 정보가 있으면 자동으로 노드에 표시
2. **유연성**: 시간을 알면 입력하고, 모르면 생략 가능
3. **통합**: 기본 flowchart + 시간 표시를 하나의 규칙으로 통합

---

## [CRITICAL] 시작하기 전 필수 조건

### 프로세스 이름 확인 프로토콜 (절대적 필수 - BLOCKING REQUIREMENT)

**트리거 조건 (다음 중 하나라도 해당되면 즉시 적용):**

- 사용자가 "프로세스맵", "프로세스 생성", "플로우차트", "다이어그램 작성" 등을 요청한 경우
- 사용자가 프로세스 내용이나 설명을 제공한 경우
- 사용자가 프로세스 이름을 언급했지만 명확한 확인을 받지 않은 경우

**필수 행동 (예외 없음):**

1. **즉시 모든 작업을 중단**
2. **반드시 다음 중 하나의 질문을 먼저 수행**:
   - 케이스 A (사용자가 프로세스 이름을 전혀 언급하지 않은 경우):
     - "프로세스 이름을 무엇으로 하시겠습니까?"
   - 케이스 B (사용자가 프로세스 이름을 언급한 경우):
     - "프로세스 이름을 '{사용자가 언급한 이름}'으로 하시겠습니까?"
3. **사용자 응답 대기**: 프로세스 이름 확인 전에는 어떤 파일도 폴더도 생성하지 않습니다
4. **확인 후 진행**: 사용자가 프로세스 이름을 명시적으로 확정한 후에만 작업을 시작합니다

---

## [핵심] 입력 포맷 규칙

### 유연한 입력 형식

사용자가 제공하는 프로세스 정보는 다음 형식을 따릅니다:

```
## 현재 프로세스
1. [단계명]: [누가] [어디서] [무엇을] - [소요시간]    ← 시간 있으면 입력
2. [단계명]: [누가] [어디서] [무엇을]                  ← 시간 없으면 생략
3. [단계명]: [누가] [어디서] [무엇을] - [소요시간]    ← 섞어서 사용 가능
```

### 시간 표기 예시

- `- 5분`
- `- 10분`
- `- 2시간`
- `- 평균 3시간`
- `- 약 30초`

### 자동 감지 규칙

**AI는 입력 데이터를 분석하여:**
1. 시간 정보 (`- N분`, `- N시간` 등)가 있는 경우
   - 노드 레이블에 `<br/>소요: N분` 형태로 추가
2. 시간 정보가 없는 경우
   - 노드 레이블에 시간 표시 없이 작업 내용만 표시

---

## 입력 예시

### 예시 1: 시간 정보 혼합

```
@mermaid-flowchart-adaptive.mdc

발권 프로세스 만들어줘

## 현재 상황
- 업무: 항공권 예약 확정
- 담당: 운영팀
- 빈도: 80건/일

## 현재 프로세스
1. VOF 확인: 운영팀이 VOF에서 미확정 예약 확인 - 3분
2. 코멘트 검토: 운영팀이 VOF에서 코멘트 읽고 사유 파악
3. GDS 조회: 운영팀이 GDS에서 좌석 상태 확인 - 5분
4. 승인 대기: 팀장이 확정 내역 검토 - 평균 3시간
5. 발권 실행: 운영팀이 GDS에서 발권 처리 - 3분
```

**출력 다이어그램:**

```mermaid
A1[온라인: VOF 확인<br/>소요: 3분]:::online
A2[온라인: 코멘트 검토]:::online
A3[온라인: GDS 조회<br/>소요: 5분]:::online
A4[온라인: 승인 대기<br/>소요: 평균 3시간]:::online
A5[온라인: 발권 실행<br/>소요: 3분]:::online
```

---

## 기본 규칙 (mermaid-flowchart.mdc와 동일)

### 1. 이모지 절대 사용 금지
- 모든 다이어그램에서 이모지를 절대 사용하지 않습니다

### 2. Mermaid 공식 문법 100% 준수
- 공식 문서(https://mermaid.js.org/syntax/flowchart.html)의 문법을 정확히 따릅니다

### 3. 온라인/오프라인 작업 명확 구분

**온라인 작업 (실시간 처리):**
- 사용자 요청에 대한 즉각적 응답
- 스타일: `classDef online fill:#90EE90,stroke:#2E8B57,stroke-width:3px,color:#000`

**오프라인 작업 (비동기 처리):**
- 배치 작업 (스케줄러, cron)
- 스타일: `classDef offline fill:#ADD8E6,stroke:#4682B4,stroke-width:3px,color:#000`

### 4. 다이어그램 구조 원칙

**[CRITICAL] 시작/종료 노드 배치:**
- 시작 노드와 종료 노드는 반드시 subgraph 외부에 독립적으로 배치
- 시작 노드: `([온라인: 프로세스명 시작]):::online`
- 종료 노드: `([온라인: 프로세스명 종료]):::online`

**[CRITICAL] 조건 분기 노드 배치:**
- 조건 분기 노드(마름모)는 반드시 subgraph 외부에 배치

**Swimlane 명명 규칙:**
- 형식: "팀명 - 시스템명"
- 예시: "운영팀 - VOF 시스템", "운영팀 - GDS 시스템"

---

## [CRITICAL] Subgraph 분리/통합 규칙

### 핵심 원칙

**연속된 같은 팀-시스템 작업은 반드시 하나의 subgraph로 통합합니다.**

### 통합/분리 판단 알고리즘

```
1. 이 노드와 다음 노드가 같은 "팀명 - 시스템명"인가?
   - YES → 같은 subgraph에 포함
   - NO → 다른 subgraph로 분리

2. 중간에 다른 시스템이 끼어있는가?
   - YES → 분리
   - NO → 통합
```

---

## [CRITICAL] 분기 패턴 규칙

### 병렬 분기 vs 순차 분기

**병렬 분기 사용 시점:**
- 조건이 해당하는 경우만 처리하고, 미해당은 경로가 없을 때
- 여러 조건이 독립적으로 확인될 때

**순차 분기 사용 시점:**
- 조건의 결과값에 따라 각각 다른 처리 작업이 있을 때
- "해당하면 A, 미해당하면 B" 형태

---

## 노드 타입 및 문법

### 기본 노드 형태
- `[텍스트]` - 사각형 (일반 프로세스)
- `([텍스트])` - 둥근 사각형 (시작/종료)
- `{텍스트}` - 마름모 (조건/판단)
- `[(텍스트)]` - 원통형 (데이터베이스)

### 시간 정보가 있는 노드 작성

**입력에 시간이 있는 경우:**
```
입력: "VOF 확인: 운영팀이 VOF에서 확인 - 5분"

출력: A1[온라인: VOF 확인<br/>소요: 5분]:::online
```

**입력에 시간이 없는 경우:**
```
입력: "코멘트 검토: 운영팀이 VOF에서 검토"

출력: A2[온라인: 코멘트 검토]:::online
```

---

## 연결선 (Edge) 문법

### 기본 연결
- `-->` - 화살표 (일반 흐름)
- `---` - 선 (연관 관계)
- `-.->` - 점선 화살표 (선택적 흐름)
- `==>` - 굵은 화살표 (중요 흐름)

### 레이블이 있는 연결
- `-->|레이블|` - 레이블이 있는 화살표
- 예시: `A1 -->|성공| A2`

---

## 파일 구조 및 저장

### 폴더 및 파일 생성 규칙

1. **폴더 생성**
   - 프로세스 이름으로 폴더를 생성
   - 공백은 언더스코어(_)로 대체

2. **파일 생성**
   - **반드시 `.md` 확장자 사용** (`.mmd` 아님)
   - 파일명 형식: `프로세스명.md`

3. **파일 구조**
   - Markdown 파일 내에 Mermaid 다이어그램 포함
   - **반드시 \`\`\`mermaid 로 시작하고 \`\`\` 로 끝남**

---

## 표준 파일 템플릿

```markdown
# 프로세스명

## 프로세스 개요

- **업무**: [업무명]
- **담당**: [팀명]
- **빈도**: [N건/일]

## 프로세스 플로우차트

\`\`\`mermaid
flowchart TD
    %% 시작 노드
    Start([온라인: 프로세스 시작]):::online

    %% 시스템별 subgraph
    subgraph System1["팀명 - 시스템명"]
        direction TB
        A1[온라인: 작업 설명<br/>소요: 5분]:::online
        A2[온라인: 작업 설명2]:::online
    end

    %% 종료 노드
    End([온라인: 프로세스 종료]):::online

    %% 연결
    Start --> A1 --> A2 --> End

    %% 스타일 정의
    classDef online fill:#90EE90,stroke:#2E8B57,stroke-width:3px,color:#000
    classDef offline fill:#ADD8E6,stroke:#4682B4,stroke-width:3px,color:#000
\`\`\`

## 프로세스 상세 설명

[각 단계별 상세 설명]

## 시간 분석 (시간 정보가 있는 경우)

| 단계 | 소요 시간 |
|------|-----------|
| VOF 확인 | 5분 |
| 코멘트 검토 | (미측정) |
| GDS 조회 | 10분 |

총 측정된 시간: 15분
```

---

## 실시간 작업 체크리스트

### [CRITICAL] STEP 0: 프로세스 이름 확인
- [ ] 사용자에게 프로세스 이름을 질문했는가?
- [ ] 사용자로부터 명시적 확인을 받았는가?

### [REQUIRED] STEP 1: 입력 데이터 분석
- [ ] 각 단계별로 시간 정보 유무를 확인했는가?
- [ ] 시간 정보를 정확히 파싱했는가? (`- 5분`, `- 2시간` 등)

### [REQUIRED] STEP 2: 노드 생성
- [ ] 시간 정보가 있는 노드에 `<br/>소요: N분` 형태로 추가했는가?
- [ ] 시간 정보가 없는 노드는 작업 내용만 표시했는가?
- [ ] 모든 노드에 온라인/오프라인 접두사가 있는가?

### [REQUIRED] STEP 3: 다이어그램 구조
- [ ] 시작/종료 노드가 subgraph 외부에 배치되었는가?
- [ ] 조건 분기 노드가 subgraph 외부에 배치되었는가?
- [ ] Subgraph가 "팀명 - 시스템명" 형식인가?

### [REQUIRED] STEP 4: 스타일 정의
- [ ] classDef online 스타일이 정의되었는가?
- [ ] classDef offline 스타일이 정의되었는가?
- [ ] 모든 노드에 :::online 또는 :::offline 클래스가 적용되었는가?

---

## 실제 예시

### 예시: 시간 정보 혼합 프로세스

```mermaid
flowchart TD
    Start([온라인: 발권 프로세스 시작]):::online
    
    subgraph OPS_VOF["운영팀 - VOF 시스템"]
        direction TB
        A1[온라인: 미확정 예약 확인<br/>소요: 3분]:::online
        A2[온라인: 코멘트 검토]:::online
    end
    
    subgraph OPS_GDS["운영팀 - GDS 시스템"]
        direction TB
        B1[온라인: 좌석 상태 확인<br/>소요: 5분]:::online
        B2[온라인: 발권 실행<br/>소요: 3분]:::online
    end
    
    Cond1{온라인: 승인 필요 여부}:::online
    
    subgraph Manager["팀장"]
        direction TB
        C1[온라인: 승인 대기<br/>소요: 평균 3시간]:::online
    end
    
    End([온라인: 발권 프로세스 종료]):::online
    
    Start --> A1 --> A2 --> B1 --> Cond1
    Cond1 -->|필요| C1 --> B2
    Cond1 -->|불필요| B2
    B2 --> End
    
    classDef online fill:#90EE90,stroke:#2E8B57,stroke-width:3px,color:#000
    classDef offline fill:#ADD8E6,stroke:#4682B4,stroke-width:3px,color:#000
```

---

## 절대 금지 사항

### [CRITICAL] 차단 수준 위반
1. **프로세스 이름을 사용자에게 묻지 않고 임의로 결정하는 것**
2. **시작/종료 노드를 subgraph 내부에 배치하는 것**
3. **조건 분기 노드를 subgraph 내부에 배치하는 것**

### [REQUIRED] 필수 규칙 위반
4. `.mmd` 확장자 사용 (반드시 `.md` 사용)
5. 이모지 사용
6. 온라인/오프라인 접두사 생략
7. classDef 스타일 정의 생략

---

## Adaptive 기능 핵심 정리

### 입력 분석
```
"VOF 확인 - 5분"     → 시간 있음 → 노드에 표시
"코멘트 검토"         → 시간 없음 → 노드에 미표시
"GDS 조회 - 10분"    → 시간 있음 → 노드에 표시
```

### 출력 생성
```mermaid
A1[온라인: VOF 확인<br/>소요: 5분]:::online
A2[온라인: 코멘트 검토]:::online
A3[온라인: GDS 조회<br/>소요: 10분]:::online
```

### 장점
1. ✅ **유연성**: 시간 알면 넣고, 모르면 생략
2. ✅ **자동화**: AI가 자동으로 감지하여 처리
3. ✅ **점진적**: 나중에 시간 측정하면 추가 가능
4. ✅ **일관성**: 하나의 규칙으로 모든 케이스 처리

---

**핵심 원칙: 입력 데이터에 적응(Adaptive)하여, 있는 정보는 표시하고 없는 정보는 강요하지 않는다.**
