---
description: 프로세스맵 작성 요청시
alwaysApply: true
---

# Mermaid Flowchart 작성 규칙

## [CRITICAL] 시작하기 전 필수 조건

### 프로세스 이름 확인 프로토콜 (절대적 필수 - BLOCKING REQUIREMENT)

**트리거 조건 (다음 중 하나라도 해당되면 즉시 적용):**

- 사용자가 "프로세스맵", "프로세스 생성", "플로우차트", "다이어그램 작성" 등을 요청한 경우
- 사용자가 프로세스 내용이나 설명을 제공한 경우
- 사용자가 프로세스 이름을 언급했지만 명확한 확인을 받지 않은 경우

**필수 행동 (예외 없음):**

1. **즉시 모든 작업을 중단**
2. **반드시 다음 중 하나의 질문을 먼저 수행**:
   - 케이스 A (사용자가 프로세스 이름을 전혀 언급하지 않은 경우):
     - "프로세스 이름을 무엇으로 하시겠습니까?"
   - 케이스 B (사용자가 프로세스 이름을 언급한 경우):
     - "프로세스 이름을 '{사용자가 언급한 이름}'으로 하시겠습니까?"
     - 예시: "프로세스 이름을 '발권\_프로세스'로 하시겠습니까?"
3. **사용자 응답 대기**: 프로세스 이름 확인 전에는 어떤 파일도 폴더도 생성하지 않습니다
4. **확인 후 진행**: 사용자가 프로세스 이름을 명시적으로 확정한 후에만 작업을 시작합니다

**절대 금지:**

- 사용자가 이미 프로세스 이름을 언급했다는 이유로 질문을 생략하는 것
- 프로세스 이름을 AI가 임의로 결정하는 것
- 확인 없이 바로 파일을 생성하는 것

---

## [신규] Adaptive 시간 감지 기능

### 유연한 시간 정보 입력

**사용자 입력에서 시간 정보를 자동 감지합니다:**

```
1. [단계명]: [설명] - [소요시간]    ← 시간 있으면 노드에 표시
2. [단계명]: [설명]                  ← 시간 없으면 표시 안 함
3. [단계명]: [설명] - [소요시간]    ← 혼합 가능
```

**시간 표기 예시:**
- `- 5분`, `- 10분`, `- 2시간`, `- 평균 3시간`, `- 약 30초`

**자동 처리 규칙:**
1. 입력에 시간 정보 (`- N분`, `- N시간`)가 있는 경우
   - 노드 레이블에 `<br/>소요: N분` 형태로 추가
2. 시간 정보가 없는 경우
   - 노드 레이블에 시간 표시 없이 작업 내용만 표시

**예시:**
```
입력: "VOF 확인: 운영팀이 VOF에서 확인 - 5분"
출력: A1[온라인: VOF 확인<br/>소요: 5분]:::online

입력: "코멘트 검토: 운영팀이 VOF에서 검토"
출력: A2[온라인: 코멘트 검토]:::online
```

---

## Quick Start 워크플로우

프로세스맵 작성 요청 시 다음 순서를 **반드시** 따릅니다:

### STEP 0: 프로세스 이름 확인 (BLOCKING)

- [ ] 사용자에게 프로세스 이름을 질문했는가?
- [ ] 사용자로부터 명시적 확인을 받았는가?
- **NO이면 작업 중단하고 질문 수행**

### STEP 1: 폴더 생성

- [ ] 사용자가 확정한 프로세스 이름으로 폴더 생성
- [ ] 공백을 언더스코어(\_)로 변환

### STEP 2: Markdown 파일 생성

- [ ] 폴더 내에 `프로세스명.md` 파일 생성
- [ ] 반드시 `.md` 확장자 사용 (`.mmd` 아님)

### STEP 3: Mermaid 다이어그램 작성

- [ ] 반드시 \`\`\`mermaid 로 시작
- [ ] flowchart TD로 시작
- [ ] 모든 규칙 준수
- [ ] 반드시 \`\`\` 로 종료

### STEP 4: 검증

- [ ] 체크리스트 확인
- [ ] 문법 오류 확인

---

## 필수 준수 사항

### 1. 이모지 절대 사용 금지

- 모든 다이어그램에서 이모지를 절대 사용하지 않습니다
- 노드 레이블, 엣지 레이블, 서브그래프 제목 등 모든 텍스트에서 이모지 금지
- 텍스트만으로 명확하게 표현합니다
- 규칙 문서 자체에서도 이모지를 사용하지 않습니다

### 2. Mermaid 공식 문법 100% 준수

- 공식 문서(https://mermaid.js.org/syntax/flowchart.html)의 문법을 정확히 따릅니다
- 비표준 문법이나 실험적 기능은 사용하지 않습니다
- 검증된 문법만 사용합니다

### 3. 온라인/오프라인 작업 명확 구분

**온라인 작업 (실시간 처리):**

- 사용자 요청에 대한 즉각적 응답
- API 호출 및 동기 처리
- 실시간 데이터 조회/수정
- 사람이 직접 수행하는 즉각적 작업 (예: 운영팀이 VOF에서 확인)
- 스타일: 파스텔 옐로우 계열 (fill:#FFF9C4, stroke:#FFD54F)

**오프라인 작업 (비동기 처리):**

- 배치 작업 (스케줄러, cron)
- 백그라운드 작업 (큐, 워커)
- 비동기 이메일 발송
- 비동기 로그 저장
- 스타일: 파스텔 베이지 계열 (fill:#FFE0B2, stroke:#FFB74D)

**판단 기준:**

- 명확한 배치/스케줄 작업만 오프라인으로 표시
- 판단이 애매한 경우 기본값은 온라인으로 처리
- 각 노드에 반드시 "온라인:" 또는 "오프라인:" 접두사를 명시

### 4. 다이어그램 구조 원칙 (핵심)

**[CRITICAL] 시작/종료 노드 배치 규칙:**

- 시작 노드와 종료 노드는 반드시 subgraph 외부에 독립적으로 배치합니다
- 시작 노드: `([온라인: 프로세스명 시작]):::online` 형태로 최상단에 배치
- 종료 노드: `([온라인: 프로세스명 종료]):::online` 형태로 최하단에 배치
- 모든 분기 경로는 반드시 종료 노드로 합류해야 합니다

**[CRITICAL] 조건 분기 노드 배치:**

- 조건 분기 노드(마름모)는 반드시 subgraph 외부에 배치합니다
- 분기 조건은 엣지 레이블로 명시합니다 (예: `-->|가능|`, `-->|불가|`)

**Swimlane 명명 규칙:**

- 형식: "팀명 - 시스템명"
- 예시: "운영팀 - VOF 시스템", "운영팀 - GDS 시스템", "운영팀 - ZD 이메일"

---

## [CRITICAL] Subgraph 분리/통합 규칙

### 핵심 원칙

**연속된 같은 팀-시스템 작업은 반드시 하나의 subgraph로 통합합니다.**

### 통합/분리 판단 알고리즘

각 노드에 대해 다음 순서로 판단합니다:

```
1. 이 노드와 다음 노드가 같은 "팀명 - 시스템명"인가?
   - YES → 같은 subgraph에 포함
   - NO → 다른 subgraph로 분리

2. 중간에 다른 시스템이 끼어있는가?
   - YES → 분리 (앞 VOF와 뒤 VOF는 별도 subgraph)
   - NO → 통합
```

### [CRITICAL] 구체적 예시

**예시 1: 분기 경로 내 연속된 같은 시스템**

```
분기 경로: L1(GDS) → L2(GDS) → M1(VOF) → N1(VOF)

판단:
- L1 → L2: 둘 다 GDS, 연속 → 통합
- L2 → M1: GDS → VOF, 다른 시스템 → 분리
- M1 → N1: 둘 다 VOF, 연속 → 통합

결과:
subgraph OPS_GDS["운영팀 - GDS 시스템"]
    L1[...]
    L2[...]
end

subgraph OPS_VOF["운영팀 - VOF 시스템"]
    M1[...]
    N1[...]
end
```

**예시 2: 중간에 다른 시스템이 끼어있는 경우**

```
분기 경로: D1(VOF) → E1(ZD이메일) → F1(여행자) → G1(GDS) → H1(VOF)

판단:
- D1(VOF) 다음에 E1(ZD이메일)이 옴 → D1은 단독 subgraph
- E1(ZD이메일) 단독
- F1(여행자) 단독
- G1(GDS) 단독
- H1(VOF) 다음에 아무것도 없음 → H1은 단독 subgraph
- D1과 H1은 둘 다 VOF지만 중간에 다른 시스템이 있으므로 별도 subgraph

결과:
subgraph OPS_VOF_TL["운영팀 - VOF 시스템"]
    D1[온라인: TL 연장]
end

subgraph OPS_ZD["운영팀 - ZD 이메일"]
    E1[온라인: 금액 상이 안내 발송]
end

subgraph Traveler["여행자"]
    F1[온라인: 컨펌 회신]
end

subgraph OPS_GDS["운영팀 - GDS 시스템"]
    G1[온라인: 최종 금액 재확인]
end

subgraph OPS_VOF_Confirm["운영팀 - VOF 시스템"]
    H1[온라인: 확정 처리]
end
```

**예시 3: 초기 검토 단계 (연속된 같은 시스템)**

```
초기 단계: C1(VOF) → C2(VOF)

판단:
- C1 → C2: 둘 다 VOF, 연속 → 통합

결과:
subgraph OPS_VOF_Review["운영팀 - VOF 시스템"]
    C1[온라인: 미확정 사유 확인]
    C2[온라인: 코멘트 검토]
end
```

### Subgraph 통합 체크리스트

각 분기 경로마다 다음을 확인합니다:

- [ ] 연속된 같은 팀-시스템 노드들이 하나의 subgraph로 통합되었는가?
- [ ] 중간에 다른 시스템이 끼어있으면 별도 subgraph로 분리되었는가?
- [ ] 같은 팀-시스템이라도 연속되지 않으면 별도 subgraph인가?

---

## [CRITICAL] 분기 패턴 규칙

### [CRITICAL] 사용자 요구사항 분석 가이드 (최우선 확인)

**핵심 원칙: 조건의 "해당/미해당" 경로 존재 여부로 판단한다**

사용자 요구사항을 분석할 때, 각 조건에 대해 다음을 확인합니다:

1. **"해당하면"만 언급되고 "미해당"은 언급되지 않음** → **병렬 분기**
2. **"해당하면 A, 미해당하면 B"처럼 양쪽 경로가 모두 언급됨** → **순차 분기**

### [CRITICAL] 모델 간 동일 추출(일관성) 모드 - 재현성 우선 규칙

**목표:** 사용자가 같은 내용을 입력했을 때, 모델이 달라도 **추가 확인 없이 동일한 Mermaid 구조**가 생성되도록 합니다.

**트리거 조건 (하나라도 해당 시 적용):**

- 사용자가 "모든 모델에서 동일", "추출", "일관성", "표준화", "재현성" 등을 언급한 경우

**우선순위 규칙 (트리거 시 아래 규칙이 자연어 해석보다 우선):**

1. **조건 검토는 기본값을 병렬 분기(B안)로 고정한다**
   - 동일/2회 미만/불필요 같은 **미해당 경로는 절대 생성하지 않는다**
   - 조건 노드(Cond*)는 "동일 여부/필요 여부/2회 이상 여부"처럼 **질문형으로 통일**한다
   - 엣지 레이블은 **해당 케이스만** 사용한다 (예: `다름`, `2회 이상`, `필요`)

2. **자연어의 순서 표현은 ‘서술 순서’로 간주하고, 순차 체이닝 근거로 사용하지 않는다**
   - 예: "그 다음", "이후", "다음으로", "완료되면" 같은 표현이 있어도
     - **미해당이면 다음 조건으로 이동**이 명시되지 않았다면 병렬로 본다

3. **조건 내부의 선택 단계는 추가 조건 노드를 만들지 말고, 엣지 레이블로만 표현한다**
   - 예: "필요한 경우 일정 재확인"은 `-->|필요 시|` 라벨로 표현한다
   - 별도의 `CondStopoverRecheck` 같은 추가 조건 분기 노드는 만들지 않는다

4. **‘모든 과정 문제 없음’은 개별 조건의 미해당 경로로 표현하지 않는다**
   - 병렬 분기에서는 각 조건의 ‘해당 시 처리’ 경로만 End로 합류시키고,
   - 미해당인 경우는 **그 분기에서 그릴 흐름이 없는 것**으로 취급한다

**금지 예시 (트리거 시 절대 금지):**

- `CondX -->|동일| NextCond`
- `CondY -->|2회 미만| NextCond`
- `CondZ -->|불필요| End`

### [CRITICAL] 자연어 패턴 분석표

| 사용자 표현 패턴 | 분기 유형 | 이유 |
|------------------|-----------|------|
| "A가 **다르면** 처리한다" | 병렬 | "같으면"에 대한 처리 언급 없음 |
| "A가 **해당하면** 처리한다" | 병렬 | "미해당"에 대한 처리 언급 없음 |
| "A가 **필요하면** 처리한다" | 병렬 | "불필요"에 대한 처리 언급 없음 |
| "A가 **2회 이상이면** 처리한다" | 병렬 | "2회 미만"에 대한 처리 언급 없음 |
| "A가 **같거나** 처리 완료되면 B 확인" | 병렬 | 미해당 시 다음으로 넘어간다는 의미일 뿐, 순차 의존성 아님 |
| "케이스1, 케이스2, 케이스3..." 형태 | 병렬 | 케이스로 나열된 조건들은 독립적인 검토 항목 |
| "A이면 처리하고, **아니면** B 처리" | 순차 | 양쪽 경로 모두 **별도 처리**가 존재 |
| "A의 **결과값**에 따라 B 또는 C 진행" | 순차 | 조건 결과가 다음 행동을 결정 |

### [CRITICAL] 실제 분석 예시

**예시 1: 병렬 분기로 판단해야 하는 경우**

사용자 입력:
> "항공사가 다르면 처리하고, 금액이 다르면 처리하고, 스탑오버가 2회 이상이면 처리하고, 증빙서류가 필요하면 처리한다"

분석:
- "항공사가 다르면" → "같으면"에 대한 별도 처리 없음 → 병렬
- "금액이 다르면" → "같으면"에 대한 별도 처리 없음 → 병렬
- "스탑오버가 2회 이상이면" → "2회 미만이면"에 대한 별도 처리 없음 → 병렬
- "증빙서류가 필요하면" → "불필요하면"에 대한 별도 처리 없음 → 병렬

결론: **4개 조건 모두 병렬 분기**

**예시 2: 병렬 분기로 판단해야 하는 경우 (케이스 형태)**

사용자 입력:
> "케이스1: 항공사가 다르면 처리한다. 케이스2: 같거나 완료되면 금액 확인한다. 케이스3: 스탑오버 2회 이상이면 처리한다. 케이스4: 증빙서류 필요하면 처리한다."

분석:
- "케이스1, 케이스2, 케이스3, 케이스4"로 나열됨 → 독립적인 검토 항목
- "같거나 완료되면"은 미해당 시 흐름 설명일 뿐, 별도 처리가 아님
- 각 케이스는 "해당하면" 처리하고 "미해당이면" 처리할 게 없음

결론: **4개 조건 모두 병렬 분기 (미해당 경로 없음)**

**예시 3: 순차 분기로 판단해야 하는 경우**

사용자 입력:
> "항공사가 다르면 A 처리하고, 같으면 B 처리한다"

분석:
- "다르면 A 처리" + "같으면 B 처리" → 양쪽 모두 **별도 처리 작업**이 존재 → 순차

결론: **순차 분기**

**[CRITICAL] 핵심 판단 기준:**
- **미해당 시 "다음으로 넘어간다/확인한다"** → 별도 처리 없음 → **병렬**
- **미해당 시 "별도 작업을 수행한다"** → 별도 처리 존재 → **순차**

### 패턴 1: 순차 분기 (Sequential Branching)

**사용 시점:** 조건의 **결과값(예/아니오)**에 따라 **각각 다른 처리 작업**이 있을 때

- "해당하면 A 처리, 미해당하면 B 처리" 형태
- 양쪽 경로 모두 **별도의 처리 작업**이 존재
- **주의: "미해당이면 다음으로 넘어간다"는 별도 처리가 아님 → 병렬로 판단**

**순차 분기 구조:**

```
조건A 확인 → 해당 → 처리A
           → 미해당 → 처리B (별도 작업)
```

### 패턴 2: 병렬 분기 (Parallel Branching) - 핵심 패턴

**사용 시점:** 조건이 **해당하는 경우만** 처리하고, **미해당은 경로 자체가 없을 때**

- 검토 후 여러 조건이 독립적으로 확인됨
- 각 조건은 서로 영향을 주지 않음
- **해당하는 조건만 처리하고, 미해당 조건은 별도 경로 없음**
- 모든 처리 경로가 종료로 합류

**[CRITICAL] 병렬 분기 구조:**

```
검토 노드
    |
    +------+------+------+
    |      |      |      |
    v      v      v      v
조건1   조건2   조건3   조건4
    |      |      |      |
   해당   해당   해당   해당
    |      |      |      |
    v      v      v      v
처리1   처리2   처리3   처리4
    |      |      |      |
    +------+------+------+
           |
           v
         종료
```

**[CRITICAL] 병렬 분기 연결 코드 패턴:**

```mermaid
%% 병렬 분기: 검토 노드에서 여러 조건으로 동시 분기
검토노드 --> Cond1
검토노드 --> Cond2
검토노드 --> Cond3
검토노드 --> Cond4

%% 각 조건별 처리 - 해당하는 경우만 처리 경로 존재
%% 미해당 경로는 만들지 않음 (별도 화살표 없음)
Cond1 -->|해당| 처리1 --> End
Cond2 -->|해당| 처리2 --> End
Cond3 -->|해당| 처리3 --> End
Cond4 -->|해당| 처리4 --> End
```

**[CRITICAL] 병렬 분기에서 절대 금지:**

- 미해당 조건에 대해 `-->|미해당| End` 같은 별도 경로를 만들지 않습니다
- 조건이 미해당이면 해당 분기는 그냥 처리할 게 없는 것입니다
- 오직 "해당"하는 경우의 처리 경로만 그립니다

### 패턴 판단 기준 요약

| 상황 | 사용할 패턴 |
|------|-------------|
| "케이스1, 케이스2, 케이스3..." 형태 | **병렬 분기** |
| "A와 B를 각각 확인" | **병렬 분기** |
| "A, B, C, D 조건을 모두 확인" | **병렬 분기** |
| 조건들이 서로 독립적 | **병렬 분기** |
| **"해당하면"만 처리, 미해당은 "다음으로"** | **병렬 분기** |
| "같거나 완료되면 다음 확인" | **병렬 분기** (미해당 시 별도 처리 없음) |
| "A이면 처리A, A 아니면 처리B" | 순차 분기 (양쪽 모두 별도 처리) |
| 조건 결과값이 다음 처리를 결정 | 순차 분기 |

---

## 표준 템플릿

### 병렬 분기 템플릿 (Subgraph 적절히 통합/분리)

```mermaid
flowchart TD
    %% 시작 노드
    Start([온라인: 프로세스 시작]):::online

    %% 초기 검토 단계 - 연속된 같은 시스템은 통합
    subgraph OPS_VOF_Review["운영팀 - VOF 시스템"]
        direction TB
        C1[온라인: 미확정 사유 확인]:::online
        C2[온라인: 코멘트 검토]:::online
    end

    %% 조건 분기 노드들 (subgraph 외부, 병렬)
    Cond1{온라인: 조건1 확인}:::online
    Cond2{온라인: 조건2 확인}:::online
    Cond3{온라인: 조건3 확인}:::online

    %% 분기 경로 1: VOF → ZD → 여행자 → GDS → VOF
    %% 중간에 다른 시스템이 끼어있으므로 각각 분리
    subgraph Path1_VOF1["운영팀 - VOF 시스템"]
        direction TB
        D1[온라인: 작업1]:::online
    end

    subgraph Path1_ZD["운영팀 - ZD 이메일"]
        direction TB
        E1[온라인: 작업2]:::online
    end

    subgraph Path1_Traveler["여행자"]
        direction TB
        F1[온라인: 작업3]:::online
    end

    subgraph Path1_GDS["운영팀 - GDS 시스템"]
        direction TB
        G1[온라인: 작업4]:::online
    end

    subgraph Path1_VOF2["운영팀 - VOF 시스템"]
        direction TB
        H1[온라인: 작업5]:::online
    end

    %% 분기 경로 2: GDS → GDS → VOF → VOF
    %% 연속된 같은 시스템은 통합
    subgraph Path2_GDS["운영팀 - GDS 시스템"]
        direction TB
        L1[온라인: 작업1]:::online
        L2[온라인: 작업2]:::online
    end

    subgraph Path2_VOF["운영팀 - VOF 시스템"]
        direction TB
        M1[온라인: 작업3]:::online
        N1[온라인: 작업4]:::online
    end

    %% 분기 경로 3: ZD → 여행자 → VOF → VOF
    %% 연속된 VOF는 통합
    subgraph Path3_ZD["운영팀 - ZD 이메일"]
        direction TB
        O1[온라인: 작업1]:::online
    end

    subgraph Path3_Traveler["여행자 - 마이트립"]
        direction TB
        P1[온라인: 작업2]:::online
    end

    subgraph Path3_VOF["운영팀 - VOF 시스템"]
        direction TB
        Q1[온라인: 작업3]:::online
        R1[온라인: 작업4]:::online
    end

    %% 종료 노드
    End([온라인: 프로세스 종료]):::online

    %% 연결 흐름
    Start --> C1 --> C2
    
    %% 검토 후 병렬로 여러 조건 분기
    C2 --> Cond1
    C2 --> Cond2
    C2 --> Cond3

    %% 각 조건별 처리 - 해당하는 경우만 (미해당 경로 없음)
    Cond1 -->|해당| D1 --> E1 --> F1 --> G1 --> H1 --> End
    Cond2 -->|해당| L1 --> L2 --> M1 --> N1 --> End
    Cond3 -->|해당| O1 --> P1 --> Q1 --> R1 --> End

    %% 스타일 정의
    classDef online fill:#FFF9C4,stroke:#FFD54F,stroke-width:2px,color:#000
    classDef offline fill:#FFE0B2,stroke:#FFB74D,stroke-width:2px,color:#000
```

---

## 노드 타입 및 문법

### 기본 노드 형태

- `[텍스트]` - 사각형 (기본, 일반 프로세스)
- `([텍스트])` - 둥근 사각형 (시작/종료)
- `[(텍스트)]` - 원통형 (데이터베이스)
- `{{텍스트}}` - 육각형 (준비/설정)
- `{텍스트}` - 마름모 (조건/판단)
- `[/텍스트/]` - 평행사변형 (입력/출력)

### 노드 명명 규칙

- 노드 ID는 영문과 숫자로 구성 (예: A1, B2, C3, Start, End, Cond1)
- 노드 레이블은 한글로 명확하게 작성
- 반드시 "온라인:" 또는 "오프라인:" 접두사 포함
- 예시: `A1[온라인: 사용자 요청 접수]:::online`

### 노드 배치 규칙

- 시작/종료 노드: subgraph 외부, ID는 Start, End 사용
- 조건 분기 노드: subgraph 외부, ID는 Cond1, Cond2 등 사용
- 일반 작업 노드: subgraph 내부, ID는 A1, B1, C1 등 사용

## 연결선 (Edge) 문법

### 기본 연결

- `-->` - 화살표 (일반 흐름)
- `---` - 선 (연관 관계)
- `-.->` - 점선 화살표 (선택적 흐름)
- `==>` - 굵은 화살표 (중요 흐름)

### 레이블이 있는 연결

- `-->|레이블|` - 레이블이 있는 화살표
- `---|레이블|` - 레이블이 있는 선
- 예시: `A1 -->|성공| A2` 또는 `A1 -->|실패| E1`

### 연결 규칙

- 모든 연결은 subgraph 정의 이후에 작성합니다
- 분기 조건은 반드시 레이블로 명시합니다
- 모든 경로는 종료 노드로 합류해야 합니다
- **병렬 분기에서 미해당 경로는 만들지 않습니다**

## 스타일 규칙 (필수)

모든 flowchart에는 반드시 다음 스타일 정의를 포함해야 합니다:

### 온라인 작업 스타일

```
classDef online fill:#FFF9C4,stroke:#FFD54F,stroke-width:2px,color:#000
```

### 오프라인 작업 스타일

```
classDef offline fill:#FFE0B2,stroke:#FFB74D,stroke-width:2px,color:#000
```

### 에러/예외 처리 스타일 (선택적)

```
classDef error fill:#FFB6C1,stroke:#DC143C,stroke-width:3px,color:#000
```

### 스타일 적용 방법

- 노드 정의 시 `:::className` 문법 사용
- 예시: `A1[온라인: 프로세스]:::online`

## 주석 작성 규칙

- `%%` 로 시작하는 주석을 사용합니다
- 각 swimlane 시작 전에 주석으로 설명을 추가합니다
- 복잡한 로직에는 주석으로 설명을 보충합니다
- 예시: `%% 운영팀 - VOF 시스템`

## 파일 구조 및 저장

### 폴더 및 파일 생성 규칙

1. **폴더 생성**

   - 프로세스 이름으로 폴더를 생성합니다
   - 폴더명 형식: `프로세스명` (예: `발권_프로세스`, `주문_처리`, `사용자_인증`)
   - 공백은 언더스코어(\_)로 대체합니다

2. **파일 생성**

   - **반드시 `.md` 확장자를 사용합니다** (`.mmd` 아님)
   - 파일명 형식: `프로세스명.md`
   - 예: `발권_프로세스/발권_프로세스.md`, `주문_처리/주문_처리.md`

3. **파일 구조**
   - Markdown 파일 내에 Mermaid 다이어그램을 포함합니다
   - **반드시 \`\`\`mermaid 로 시작하고 \`\`\` 로 끝나야 합니다**

### 표준 파일 템플릿

```markdown
# 프로세스명

## 프로세스 개요

[프로세스에 대한 간단한 설명]

## 프로세스 플로우차트

\`\`\`mermaid
flowchart TD
    %% 시작 노드
    Start([온라인: 프로세스 시작]):::online

    %% 시스템별 subgraph
    subgraph System1["팀명 - 시스템명"]
        direction TB
        A1[온라인: 작업 설명]:::online
    end

    %% 종료 노드
    End([온라인: 프로세스 종료]):::online

    %% 연결
    Start --> A1
    A1 --> End

    %% 스타일 정의
    classDef online fill:#FFF9C4,stroke:#FFD54F,stroke-width:2px,color:#000
    classDef offline fill:#FFE0B2,stroke:#FFB74D,stroke-width:2px,color:#000
\`\`\`

## 프로세스 상세 설명

[각 단계별 상세 설명]
```

### 파일 저장 위치 예시

```
프로젝트_루트/
├── 발권_프로세스/
│   └── 발권_프로세스.md
├── 주문_처리/
│   └── 주문_처리.md
└── 사용자_인증/
    └── 사용자_인증.md
```

## 실시간 작업 체크리스트

작업 진행 중 각 단계마다 확인합니다:

### [CRITICAL] STEP 0: 시작 전 필수 확인

- [ ] 사용자에게 프로세스 이름을 질문했는가?
- [ ] 사용자로부터 프로세스 이름 확인을 받았는가?
- **NO이면 즉시 작업 중단하고 질문 수행**

### [REQUIRED] STEP 1: 폴더 생성

- [ ] 사용자가 확정한 프로세스 이름으로 폴더를 생성했는가?
- [ ] 공백을 언더스코어(\_)로 변환했는가?

### [REQUIRED] STEP 2: 파일 생성

- [ ] `.md` 확장자로 파일을 생성했는가? (`.mmd` 아님)
- [ ] 파일명이 `프로세스명.md` 형식인가?
- [ ] 파일이 \`\`\`mermaid 로 시작하고 \`\`\` 로 끝나는가?

### [REQUIRED] STEP 3: 다이어그램 구조

- [ ] flowchart TD로 시작했는가?
- [ ] 시작/종료 노드가 subgraph 외부에 배치되었는가?
- [ ] 조건 분기 노드가 subgraph 외부에 배치되었는가?
- [ ] 각 subgraph가 "팀명 - 시스템명" 형식인가?
- [ ] 모든 경로가 종료 노드로 합류하는가?

### [REQUIRED] STEP 4: Subgraph 통합/분리 확인

- [ ] 각 분기 경로에서 연속된 같은 팀-시스템 노드들이 하나의 subgraph로 통합되었는가?
- [ ] 중간에 다른 시스템이 끼어있으면 별도 subgraph로 분리되었는가?
- [ ] 같은 팀-시스템이라도 연속되지 않으면 별도 subgraph인가?

### [REQUIRED] STEP 5: 분기 패턴 확인

- [ ] 조건들이 독립적인가? (병렬 분기 사용)
- [ ] 조건들이 순서 의존적인가? (순차 분기 사용)
- [ ] 병렬 분기 시 하나의 노드에서 여러 조건으로 동시 분기하는가?
- [ ] **병렬 분기에서 미해당 경로를 만들지 않았는가?**
- [ ] 각 분기 경로가 종료로 합류하는가?

### [REQUIRED] STEP 6: 노드 작성

- [ ] 입력 데이터에서 시간 정보를 정확히 파싱했는가? (Adaptive 기능)
- [ ] 시간 정보가 있는 노드에 `<br/>소요: N분` 형태로 추가했는가?
- [ ] 시간 정보가 없는 노드는 작업 내용만 표시했는가?
- [ ] 모든 노드에 "온라인:" 또는 "오프라인:" 접두사가 명시되었는가?
- [ ] 모든 노드에 :::online 또는 :::offline 클래스가 적용되었는가?
- [ ] 노드 타입이 용도에 맞게 선택되었는가? (사각형, 마름모, 둥근 사각형 등)
- [ ] 이모지가 사용되지 않았는가?

### [REQUIRED] STEP 7: 스타일 정의

- [ ] classDef online 스타일이 정의되었는가?
- [ ] classDef offline 스타일이 정의되었는가?
- [ ] 색상이 규칙에 맞는가? (온라인: 파스텔 옐로우, 오프라인: 파스텔 베이지)

### [RECOMMENDED] STEP 8: 품질 확인

- [ ] 노드 간 연결이 논리적으로 올바른가?
- [ ] 주석이 적절히 작성되었는가?
- [ ] Mermaid 공식 문법을 100% 준수했는가?
- [ ] 복잡한 분기에 레이블이 추가되었는가?

---

## 실제 예제

### 발권 프로세스 (병렬 분기, Subgraph 적절히 통합/분리)

이 예제는 코멘트 검토 후 4개의 조건을 **병렬로 동시에 확인**하고, **연속된 같은 시스템은 통합, 중간에 다른 시스템이 끼면 분리**한 구조입니다.

```mermaid
flowchart TD
    %% 시작 노드
    Start([온라인: 발권 프로세스 시작]):::online

    %% VOF 시스템 - 자동 판단 (연속된 흐름이므로 통합)
    subgraph VOF_Auto["VOF 시스템"]
        direction TB
        A1{온라인: 자동 확정 가능 여부 판단}:::online
        A2[온라인: 자동 확정 처리]:::online
        A3[온라인: 자동 확정 불가 수동 처리 필요]:::online
        B1[온라인: 결제 및 발권]:::online
    end

    %% 운영팀 - VOF 시스템 (초기 검토 - 연속된 흐름이므로 통합)
    subgraph OPS_VOF_Review["운영팀 - VOF 시스템"]
        direction TB
        C1[온라인: 미확정 사유 확인]:::online
        C2[온라인: 코멘트 검토]:::online
    end

    %% 조건 분기 노드들 (subgraph 외부, 병렬 분기)
    Cond1{온라인: 예약 금액과 발권 금액 동일 여부}:::online
    Cond2{온라인: 출국 귀국 항공사 동일 여부}:::online
    Cond3{온라인: 스탑오버 2회 이상 여부}:::online
    Cond4{온라인: 증빙서류 필요 여부}:::online

    %% ===== 분기 경로 1: 금액 상이 처리 =====
    %% D1(VOF) → E1(ZD) → F1(여행자) → G1(GDS) → H1(VOF)
    %% 중간에 다른 시스템이 끼어있으므로 각각 분리

    subgraph OPS_VOF_TL["운영팀 - VOF 시스템"]
        direction TB
        D1[온라인: TL 연장]:::online
    end

    subgraph OPS_ZD_Price["운영팀 - ZD 이메일"]
        direction TB
        E1[온라인: 금액 상이 안내 발송]:::online
    end

    subgraph Traveler_Confirm["여행자"]
        direction TB
        F1[온라인: 컨펌 회신]:::online
    end

    subgraph OPS_GDS_Price["운영팀 - GDS 시스템"]
        direction TB
        G1[온라인: 최종 금액 재확인]:::online
    end

    subgraph OPS_VOF_Confirm["운영팀 - VOF 시스템"]
        direction TB
        H1[온라인: 확정 처리]:::online
    end

    %% ===== 분기 경로 2: 항공사 상이 처리 =====
    %% I1(VOF) → J1(GDS) → K1(VOF)
    %% 중간에 GDS가 끼어있으므로 VOF 분리

    subgraph OPS_VOF_Schedule["운영팀 - VOF 시스템"]
        direction TB
        I1[온라인: 여행 일정 확인]:::online
    end

    subgraph OPS_GDS_Reserve["운영팀 - GDS 시스템"]
        direction TB
        J1[온라인: 확정 가능 예약 조회]:::online
    end

    subgraph OPS_VOF_Reserve["운영팀 - VOF 시스템"]
        direction TB
        K1[온라인: 예약 확정 또는 취소 처리]:::online
    end

    %% ===== 분기 경로 3: 스탑오버 처리 =====
    %% L1(GDS) → L2(GDS) → M1(VOF) → N1(VOF)
    %% 연속된 GDS는 통합, 연속된 VOF는 통합

    subgraph OPS_GDS_Fare["운영팀 - GDS 시스템"]
        direction TB
        L1[온라인: 운임 규정 확인]:::online
        L2[온라인: 스탑오버 가능 여부 확인]:::online
    end

    subgraph OPS_VOF_Stopover["운영팀 - VOF 시스템"]
        direction TB
        M1[온라인: 사용 가능한 일정 재확인]:::online
        N1[온라인: 예약 확정 또는 취소 처리]:::online
    end

    %% ===== 분기 경로 4: 증빙서류 처리 =====
    %% O1(ZD) → P1(여행자) → Q1(VOF) → R1(VOF)
    %% 연속된 VOF는 통합

    subgraph OPS_ZD_Doc["운영팀 - ZD 이메일"]
        direction TB
        O1[온라인: 서류 제출 요청 발송]:::online
    end

    subgraph Traveler_MyTrip["여행자 - 마이트립 내여행"]
        direction TB
        P1[온라인: 서류 업로드]:::online
    end

    subgraph OPS_VOF_Doc["운영팀 - VOF 시스템"]
        direction TB
        Q1[온라인: 서류 확인]:::online
        R1[온라인: 확정 진행]:::online
    end

    %% 종료 노드
    End([온라인: 발권 프로세스 종료]):::online

    %% 연결 흐름 - 자동 확정 분기
    Start --> A1
    A1 -->|가능| A2
    A1 -->|불가| A3
    A2 --> B1
    B1 --> End
    A3 --> C1
    C1 --> C2

    %% 코멘트 검토 후 4개 조건으로 병렬 분기
    C2 --> Cond1
    C2 --> Cond2
    C2 --> Cond3
    C2 --> Cond4

    %% 각 조건별 처리 - 해당하는 경우만 (미해당 경로 없음)
    Cond1 -->|다름| D1 --> E1 --> F1 --> G1 --> H1 --> End
    Cond2 -->|다름| I1 --> J1 --> K1 --> End
    Cond3 -->|2회 이상| L1 --> L2 --> M1 --> N1 --> End
    Cond4 -->|필요| O1 --> P1 --> Q1 --> R1 --> End

    %% 스타일 정의
    classDef online fill:#FFF9C4,stroke:#FFD54F,stroke-width:2px,color:#000
    classDef offline fill:#FFE0B2,stroke:#FFB74D,stroke-width:2px,color:#000
```

---

## 추가 참고사항

### Mermaid Live Editor

- https://mermaid.live/ 에서 실시간으로 테스트 가능
- 문법 오류를 즉시 확인할 수 있습니다

### 공식 문서

- https://mermaid.js.org/syntax/flowchart.html
- 최신 문법은 공식 문서를 참조합니다

### 버전 관리

- Mermaid 버전: 10.x 이상 권장
- 프로젝트에서 사용하는 Mermaid 버전을 명시합니다

## 절대 금지 사항

### [CRITICAL] 차단 수준 위반

1. **프로세스 이름을 사용자에게 묻지 않고 임의로 결정하는 것**
2. **사용자가 이미 이름을 언급했다는 이유로 확인 질문을 생략하는 것**
3. **프로세스 이름 확인 전에 파일이나 폴더를 생성하는 것**
4. **시작/종료 노드를 subgraph 내부에 배치하는 것**
5. **조건 분기 노드를 subgraph 내부에 배치하는 것**
6. **독립적인 조건들을 순차적으로 체이닝하는 것 (병렬 분기 사용해야 함)**
7. **병렬 분기에서 미해당 경로(예: -->|동일| End)를 만드는 것**
8. **연속된 같은 팀-시스템 노드를 별도 subgraph로 분리하는 것**
9. **중간에 다른 시스템이 끼어있는데 하나의 subgraph로 통합하는 것**

### [REQUIRED] 필수 규칙 위반

10. `.mmd` 확장자 사용 (반드시 `.md` 사용)
11. 프로세스 폴더 생성 없이 파일만 생성하는 것
12. \`\`\`mermaid 와 \`\`\` 없이 Mermaid 코드 작성
13. 이모지 사용 (다이어그램 및 규칙 문서 모두)
14. 비표준 Mermaid 문법 사용
15. 온라인/오프라인 접두사 생략
16. Swimlane에 팀명-시스템명 생략
17. classDef 스타일 정의 생략
18. 노드에 :::online 또는 :::offline 클래스 적용 생략
19. 분기 경로가 종료 노드로 합류하지 않는 것

### 위반 시 조치

- CRITICAL 위반: 즉시 작업 중단하고 올바른 절차 수행
- REQUIRED 위반: 해당 부분 수정 후 진행

## 우선순위 레벨 시스템

이 규칙 문서는 3단계 우선순위 시스템을 사용합니다:

### [CRITICAL] 차단 조건

- 이 조건을 충족하지 않으면 작업을 진행할 수 없습니다
- 예: 프로세스 이름 확인, 시작/종료 노드 외부 배치, 병렬/순차 분기 패턴 준수, Subgraph 통합/분리 규칙
- 위반 시: 즉시 작업 중단

### [REQUIRED] 필수 조건

- 반드시 준수해야 하는 규칙
- 예: 파일 구조, 문법 준수, 스타일 정의
- 위반 시: 수정 후 진행

### [RECOMMENDED] 권장 사항

- 품질 향상을 위한 권장 사항
- 예: 주석 작성, 레이블 추가
- 위반 시: 경고만 표시

---

## 예외 상황 처리

### 사용자가 프로세스 이름과 내용을 동시에 제공한 경우

**잘못된 처리:**

```
사용자: "발권 프로세스 생성해줘. VOF에서 자동 확정..."
AI: [바로 파일 생성]
```

**올바른 처리:**

```
사용자: "발권 프로세스 생성해줘. VOF에서 자동 확정..."
AI: "프로세스 이름을 '발권_프로세스'로 하시겠습니까?"
사용자: "네"
AI: [파일 생성 시작]
```

### 사용자가 파일명까지 명시한 경우

**잘못된 처리:**

```
사용자: "발권_프로세스.md 파일 만들어줘"
AI: [바로 파일 생성]
```

**올바른 처리:**

```
사용자: "발권_프로세스.md 파일 만들어줘"
AI: "폴더명은 '발권_프로세스', 파일명은 '발권_프로세스.md'로 생성하시겠습니까?"
사용자: "네"
AI: [파일 생성 시작]
```

### 핵심 원칙

**사용자가 무엇을 언급했든, 반드시 명시적 확인을 받아야 합니다**
