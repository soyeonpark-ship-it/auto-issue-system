---
description: 시간 메트릭 포함 프로세스맵 작성 요청시
alwaysApply: false
---

# Mermaid Flowchart 작성 규칙 (시간 메트릭 버전)

## [CRITICAL] 기본 원칙

**이 규칙은 `mermaid-flowchart.mdc`의 모든 규칙을 상속합니다.**

- 프로세스 구조 생성은 `mermaid-flowchart.mdc`를 따릅니다
- 추가로 시간 메트릭 측정 및 삽입 기능을 제공합니다
- 3단계 워크플로우로 진행됩니다

---

## [CRITICAL] 3단계 워크플로우

### STEP 1: 프로세스 구조 + 측정 시트 생성

**트리거 조건**:
- 사용자가 "시간 메트릭 버전", "시간 측정", "AS-IS/TO-BE" 등을 언급한 경우

**실행 내용**:

1. **프로세스 이름 확인** (mermaid-flowchart.mdc 규칙 따름)
   - 반드시 사용자에게 프로세스 이름 확인

2. **기본 프로세스 맵 생성**
   - mermaid-flowchart.mdc의 모든 규칙 준수
   - 시간은 삽입하지 않음 (아직 측정 전)

3. **측정 시트 자동 생성**
   - 프로세스 맵의 모든 작업 노드 추출
   - 조건 분기 노드(마름모)는 제외
   - 시작/종료 노드는 제외
   - 측정 시트 파일 생성: `{프로세스명}_측정시트.md`

**측정 시트 포맷**:

```markdown
# {프로세스명} 시간 측정 시트

## 📋 측정 가이드

### 측정 방법
1. 스톱워치로 각 작업의 시작/종료 시간 측정
2. 최소 5~10건 측정 (권장: 10건 이상)
3. 특이 케이스(에러, 네트워크 장애 등) 제외
4. 아래 시트의 **__** 부분을 측정한 시간(숫자)으로 바꾸세요

### 측정 단위
- 시간 단위: **분** (예: 3, 180)
- 1분 미만은 소수점 (예: 0.5) 또는 초 단위로 명시 (예: 30초)

### 📝 입력 방법
- **이 파일을 직접 수정**하세요
- `__` 부분을 숫자로 바꾸면 됩니다
- 예: `- [ ] 미확정 사유 확인: __` → `- [ ] 미확정 사유 확인: 5`
- 저장 후 "측정 완료"라고 AI에게 알려주세요

---

## ⏱️ 노드별 시간 측정 (이 파일을 직접 수정하세요)

### 공통 경로
- [ ] {노드명1}: __
- [ ] {노드명2}: __

### 케이스 1: {케이스명}
- [ ] {노드명3}: __
- [ ] {노드명4}: __

### 케이스 2: {케이스명}
- [ ] {노드명5}: __
- [ ] {노드명6}: __
- [ ] {대기 노드명} (고객 응답 등): __

...

---

## 💡 측정 팁

### 처리 시간 vs 대기 시간
- **처리 시간**: 실제 작업 수행 시간
- **대기 시간**: 고객 응답, 외부 승인 대기 등
- 대기 시간도 별도 기록 (병목 파악 중요)

### 측정 예시
```
케이스: V001
- 미확정 사유 확인: 09:00 시작 → 09:03 완료 = 3분 → 입력: 3
- 코멘트 검토: 09:03 시작 → 09:05 완료 = 2분 → 입력: 2
- TL 연장: 09:05 시작 → 09:10 완료 = 5분 → 입력: 5
```

### 샘플 수집 기준
- 최소 5건: 기본 평균 파악
- 권장 10건: 신뢰도 있는 평균
- 20건 이상: 최소/최대값 분석 가능

---

## 📊 측정 완료 후

**추천 방법: 이 파일을 직접 수정 후 알림**
```
1. 위의 __ 부분을 모두 숫자로 바꾸기
2. 파일 저장
3. AI에게 "측정 완료"라고 알리기
4. AI가 이 파일을 자동으로 읽고 최종 맵 생성
```

**또는 직접 복사해서 제공**
```
미확정 사유 확인: 3
코멘트 검토: 2
TL 연장: 5
...
```

---

**다음 단계**: 측정 완료 후 "측정 완료" 또는 "시간 메트릭 맵 생성해줘"라고 요청하세요!
```

**출력 메시지**:
```
✅ 프로세스 맵과 측정 시트가 생성되었습니다!

📁 생성된 파일:
- {프로세스명}/{프로세스명}.md (기본 프로세스 맵)
- {프로세스명}/{프로세스명}_측정시트.md (시간 측정 시트)

📋 다음 단계:
1. 측정 시트를 열어보세요
2. 실제 업무 수행 시 각 작업의 소요 시간을 측정하세요
3. 측정 완료 후 평균값을 시트에 기록하세요
4. "시간 메트릭 맵 생성해줘"라고 요청하면 완성됩니다!

💡 팁: 최소 5~10건 측정을 권장합니다.
```

---

### STEP 2: 사용자 측정 대기

**AI 역할**:
- 사용자가 측정 완료할 때까지 대기
- 측정 관련 질문에 답변
- 측정 방법 가이드 제공

**측정 중 지원**:
```
사용자: "대기 시간도 측정해야 해?"
AI: "네! 고객 응답 대기 같은 대기 시간도 중요합니다. 
     전체 프로세스 시간을 파악하는 데 필수적입니다."

사용자: "몇 건 측정하면 돼?"
AI: "최소 5건, 권장 10건입니다. 
     더 많이 측정할수록 정확한 평균을 얻을 수 있습니다."
```

---

### STEP 3: 시간 데이터 입력 및 최종 맵 생성

**트리거 조건**:
- 사용자가 "시간 메트릭 맵 생성", "측정 완료", "시간 추가" 등을 언급
- 노드별 시간 데이터 제공 또는 측정 시트 파일 수정 완료

**[추천] 방법 1: 측정 시트 파일 직접 수정**
```
1. 사용자가 측정 시트 파일의 __ 부분을 숫자로 수정
2. 파일 저장
3. "측정 완료"라고 AI에게 알림
4. AI가 자동으로 해당 프로세스의 측정 시트 파일 찾아서 읽기
5. 최종 맵 생성
```

**AI 자동 처리 로직:**
- 사용자가 "측정 완료" 언급 시
- 최근 생성된 프로세스의 측정 시트 파일 자동 검색
- 파일명 패턴: `{프로세스명}_측정시트.md`
- 파일 내용 파싱하여 시간 데이터 추출

**방법 2: 데이터 직접 제공**

AI는 다음 모든 포맷을 인식합니다:

**포맷 A: 간단한 리스트**
```
미확정 사유 확인: 3
코멘트 검토: 2
TL 연장: 5
```

**포맷 B: 체크리스트**
```
- [x] 미확정 사유 확인: 3
- [x] 코멘트 검토: 2
- [x] TL 연장: 5
```

**포맷 C: 측정 시트 형식 그대로 복사**
```
- [ ] 미확정 사유 확인: 3
- [ ] 코멘트 검토: 2
- [ ] TL 연장: 5
```

**포맷 D: 테이블**
```
| 노드명 | 시간 |
|--------|------|
| 미확정 사유 확인 | 3 |
| 코멘트 검토 | 2 |
```

**처리 로직**:

1. **데이터 소스 확인**
   - 우선순위 1: 사용자가 직접 제공한 데이터
   - 우선순위 2: 측정 시트 파일 자동 검색 및 읽기

2. **데이터 파싱**
   - 노드명과 시간 추출
   - 시간 단위 인식 (분, 초, 시간)
   - 숫자만 있으면 "분" 단위로 간주
   - "분", "초" 명시된 경우 그대로 인식

3. **노드 매칭**
   - 기존 프로세스 맵의 노드 레이블과 매칭
   - "온라인:", "오프라인:" 접두사 무시
   - 부분 매칭 허용 (예: "사유 확인" → "미확정 사유 확인")
   - 매칭 실패 시 경고 메시지

4. **시간 삽입**
   - 노드 형식: `["온라인: 작업명<br/>(시간)"]:::online`
   - 대기 시간은: `["온라인: 작업명<br/>(대기 시간)"]:::online`
   - 예시: `B1["온라인: 미확정 사유 확인<br/>(3분)"]:::online`

---

## [REQUIRED] 최종 문서 구조

시간 메트릭 맵 파일명: `{프로세스명}_시간메트릭.md`

**필수 섹션**:

### 1. 상단 요약 테이블
```markdown
## ⏱️ 프로세스 시간 분석

| 지표 | AS-IS | TO-BE 목표 | 개선 목표 |
|------|-------|-----------|----------|
| 전체 평균 처리 시간 | {계산값}분 | TBD | TBD |
| 자동 처리 평균 시간 | {계산값}분 | TBD | TBD |
| 수동 처리 평균 시간 | {계산값}분 | TBD | TBD |

**참고**: TO-BE 목표는 개선 후 업데이트하세요.
```

### 2. 프로세스 개요
- 기존 프로세스 개요 유지

### 3. 프로세스 플로우차트 (시간 포함)
```markdown
## 프로세스 플로우차트 (처리 시간 포함)

[Mermaid 다이어그램 - 각 노드에 시간 표시]
```

### 4. 경로별 총 시간 분석
```markdown
## 경로별 총 처리 시간

### 자동 확정 경로
```
총 시간: {자동 계산}분
- {노드1}: {시간}분
- {노드2}: {시간}분
```

### 케이스 1: {케이스명}
```
총 시간: {자동 계산}분
- {노드1}: {시간}분
- {노드2}: {시간}분
...
```

**개선 포인트**: 가장 오래 걸리는 작업 자동 식별
```

### 5. 노드별 처리 시간 상세
```markdown
## 노드별 처리 시간 상세

| 노드명 | 평균 시간 | 개선 목표 | 개선 방법 |
|--------|----------|----------|----------|
| {노드1} | {시간}분 | TBD | TBD |
| {노드2} | {시간}분 | TBD | TBD |
...
```

### 6. 시간 기반 개선 우선순위
```markdown
## 🎯 시간 기반 개선 우선순위

| 순위 | 구간 | 현재 시간 | 비고 | 우선순위 |
|-----|------|----------|------|---------|
| 1 | {가장 긴 작업} | {시간}분 | 최대 병목 | ⭐⭐⭐ |
| 2 | {두번째 긴 작업} | {시간}분 | 개선 필요 | ⭐⭐ |
...

**자동 식별 기준**:
- 처리 시간 10분 이상: 높은 우선순위
- 대기 시간 60분 이상: 최우선 개선 대상
```

### 7. 주요 인사이트
```markdown
## 💡 주요 인사이트

### 병목 구간 Top 3
1. **{노드명}** ({시간}분) - {분석}
2. **{노드명}** ({시간}분) - {분석}
3. **{노드명}** ({시간}분) - {분석}

### 전체 프로세스 분석
- 전체 평균 시간: {계산}분
- 가장 빠른 경로: {경로명} ({시간}분)
- 가장 느린 경로: {경로명} ({시간}분)

### 개선 제안
1. **자동화 대상**: {분석 결과}
2. **대기 시간 단축**: {분석 결과}
3. **프로세스 간소화**: {분석 결과}
```

### 8. 데이터 수집 정보
```markdown
## 📊 데이터 수집 정보

- 측정 일자: {오늘 날짜}
- 측정 방법: 수작업 타이머 측정
- 샘플 수: {사용자 제공 정보 기반 추정}
- 데이터 상태: AS-IS (현재 상태)

**참고**: 
- 이 메트릭은 현재(AS-IS) 프로세스의 측정값입니다
- 개선 후 동일한 방법으로 재측정하여 TO-BE 데이터를 수집하세요
- 향후 확장 가능: 통과율, 비용, 에러율 등
```

---

## [CRITICAL] 자동 계산 및 분석

AI는 다음을 자동으로 계산하고 분석합니다:

### 1. 경로별 총 시간
- 각 분기 경로의 모든 노드 시간 합산
- 공통 경로 시간 포함

### 2. 병목 구간 식별
```
기준:
- 처리 시간 10분 이상: 개선 대상
- 처리 시간 30분 이상: 우선 개선 대상
- 대기 시간 60분 이상: 최우선 개선 대상
- 대기 시간 180분 이상: 극심한 병목 (알림 강화 필요)
```

### 3. 개선 우선순위
```
우선순위 산정:
1. 시간이 가장 긴 작업 Top 5
2. 대기 시간이 긴 작업 (고객/외부 의존)
3. 자동화 가능성 높은 작업 (수작업 반복)
```

### 4. 인사이트 생성
```
자동 생성:
- "전체 프로세스의 80%는 고객 응답 대기입니다"
- "TL 연장(5분)은 자동화 가능한 작업입니다"
- "가장 빠른 경로는 자동 확정(3분)입니다"
```

---

## [CRITICAL] 노드 매칭 규칙

**정확한 매칭 우선**:
1. 완전 일치 (대소문자 무시)
2. "온라인:"/"오프라인:" 제거 후 일치
3. 부분 문자열 매칭

**매칭 예시**:
```
사용자 입력: "사유 확인: 3분"
프로세스 맵: B1[온라인: 미확정 사유 확인]:::online
매칭: "사유 확인" ⊂ "미확정 사유 확인" ✓
결과: B1["온라인: 미확정 사유 확인<br/>(3분)"]:::online
```

**매칭 실패 시**:
```
경고 메시지:
"⚠️ 다음 노드를 찾을 수 없습니다: '{노드명}'
프로세스 맵의 노드명을 확인해주세요.

프로세스 맵의 노드 목록:
- 미확정 사유 확인
- 코멘트 검토
- TL 연장
..."
```

---

## [OPTIONAL] 확장 기능

### 통과율 추가
사용자가 통과율도 제공하면:
```
노드명: 시간, 통과율
미확정 사유 확인: 3분, 70%
```

노드 표시:
```mermaid
B1["온라인: 미확정 사유 확인<br/>(3분 | 70%)"]:::online
```

### 비용 추가
사용자가 시간당 인건비 제공하면 자동 계산:
```
사용자: "시간당 인건비 3만원 기준으로 비용도 계산해줘"

AI: [자동 계산]
- 미확정 사유 확인: 3분 → ₩1,500
- TL 연장: 5분 → ₩2,500
```

노드 표시:
```mermaid
B1["온라인: 미확정 사유 확인<br/>(3분 | ₩1.5K)"]:::online
```

---

## 실전 예시

### 예시 1: 전체 워크플로우

**1단계: 구조 생성**
```
사용자: "발권 프로세스 만들어줘. 시간 메트릭 버전으로"

AI:
1. 프로세스 이름 확인
2. 발권_프로세스/발권_프로세스.md 생성
3. 발권_프로세스/발권_프로세스_측정시트.md 생성
4. 측정 가이드 메시지 출력
```

**2단계: 사용자 측정**
```
사용자: [1주일간 측정]

작성된 측정 시트:
- 미확정 사유 확인: 3분
- 코멘트 검토: 2분
- TL 연장: 5분
- 금액 안내 발송: 8분
- 고객 응답 대기: 180분
- 최종 금액 재확인: 3분
- 확정 처리: 3분
```

**3단계: 최종 맵 생성**
```
사용자: "측정 완료!"

AI:
1. 자동으로 측정 시트 파일 검색 및 읽기
2. 데이터 파싱
3. 노드 매칭
4. 시간 삽입
5. 경로별 총 시간 계산
6. 병목 식별 및 분석
7. 발권_프로세스_타임_시간메트릭.md 생성
```

---

## 출력 메시지 템플릿

### STEP 1 완료 시
```
✅ 프로세스 맵과 측정 시트가 생성되었습니다!

📁 생성된 파일:
- {프로세스명}/{프로세스명}.md
- {프로세스명}/{프로세스명}_측정시트.md

📋 다음 단계:
1. 측정 시트를 열어 확인하세요
2. 파일에서 __ 부분을 측정한 시간(숫자)으로 바꾸세요
3. 파일 저장 후 "측정 완료"라고 말씀하세요
4. AI가 자동으로 파일을 읽고 최종 맵을 생성합니다

💡 팁: 
- 최소 5~10건 측정을 권장합니다
- 숫자만 입력하면 됩니다 (예: __ → 5)
- 단위는 자동으로 "분"으로 처리됩니다
```

### STEP 3 완료 시
```
✅ 시간 메트릭 맵이 생성되었습니다!

📁 생성된 파일:
- {프로세스명}/{프로세스명}_시간메트릭.md

📊 주요 분석 결과:
- 전체 평균 처리 시간: {계산값}분
- 최대 병목 구간: {노드명} ({시간}분)
- 가장 빠른 경로: {경로명} ({시간}분)
- 가장 느린 경로: {경로명} ({시간}분)

🎯 개선 우선순위:
1. {노드1} ({시간}분) - {이유}
2. {노드2} ({시간}분) - {이유}
3. {노드3} ({시간}분) - {이유}

💡 다음 단계:
- 개선 작업 진행
- 개선 후 동일한 방법으로 재측정
- TO-BE 데이터로 비교 분석
```

---

## 체크리스트

### STEP 1: 구조 + 측정 시트 생성
- [ ] 프로세스 이름 확인했는가?
- [ ] 기본 프로세스 맵 생성했는가? (mermaid-flowchart.mdc 준수)
- [ ] 측정 시트 생성했는가?
- [ ] 측정 시트에 모든 작업 노드가 포함되었는가?
- [ ] 조건 분기/시작/종료 노드는 제외했는가?
- [ ] 측정 가이드가 포함되었는가?
- [ ] 사용자에게 다음 단계 안내했는가?

### STEP 3: 시간 메트릭 맵 생성
- [ ] 사용자가 제공한 시간 데이터를 파싱했는가?
- [ ] 모든 노드가 정확히 매칭되었는가?
- [ ] 매칭 실패한 노드는 경고했는가?
- [ ] 각 노드에 시간이 삽입되었는가?
- [ ] 경로별 총 시간이 계산되었는가?
- [ ] 병목 구간이 식별되었는가?
- [ ] 개선 우선순위가 분석되었는가?
- [ ] 모든 필수 섹션이 포함되었는가?
- [ ] 주요 인사이트가 생성되었는가?
- [ ] 사용자에게 분석 결과를 요약해서 전달했는가?

---

## 주의사항

### 1. mermaid-flowchart.mdc 규칙 준수
- 모든 기본 규칙 (시작/종료 노드 배치, 병렬/순차 분기 등) 준수
- 시간 메트릭은 추가 기능일 뿐, 기본 구조는 동일

### 2. 시간 단위 통일
- 기본 단위: **분**
- 사용자가 "초", "시간" 입력 시 자동 변환
  - 30초 → 0.5분 (또는 "30초"로 표시)
  - 3시간 → 180분

### 3. 대기 시간 명확히 구분
- 처리 시간과 대기 시간 구분
- 대기 시간은 "(대기 180분)" 형태로 표시

### 4. 매칭 정확도
- 노드명이 정확히 일치하지 않으면 경고
- 부분 매칭 시 확인 메시지

---

**버전**: 1.0
**최종 업데이트**: 2024-12-30
